<!DOCTYPE html>
<html>
<head>
    <title>WW1 Combat Simulator</title>
    <style>
        /* Simplified and organized CSS */
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background-color: #1e1e1e; 
            color: #f0f0f0; 
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        #main-container {
            display: flex;
            justify-content: space-between;
        }

        #combat-section, #output-section, #board {
            width: 32%;
            padding: 10px;
            box-sizing: border-box;
        }

        /* Adjusted styles for combat section */
        #combat-section {
            background-color: #2e2e2e;
            border-radius: 5px;
        }

        /* Adjusted styles for output section */
        #output-section {
            background-color: #2e2e2e;
            border-radius: 5px;
            max-height: 80vh;
            overflow-y: auto;
        }

        /* Adjusted styles for board section */
        #board {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        button { 
            padding: 10px 20px; 
            font-size: 16px; 
            margin-bottom: 10px; 
            background-color: #333; 
            color: #f0f0f0; 
            border: none; 
            cursor: pointer;
        }

        button:hover { background-color: #555; }

        .unit-controls { margin-bottom: 10px; }
        .unit-group { 
            display: flex; 
            align-items: center; 
            margin-bottom: 5px; 
        }
        .unit-group span { 
            margin: 0 10px; 
        }

        /* New Class for Unit Labels */
        .unit-label {
            width: 120px; /* Fixed width to ensure alignment */
            flex: 0 0 120px; /* Prevent stretching */
        }

        /* Faction colors */
        .cascadea { color: rgb(53, 106, 29); } /* Green for Cascadea */
        .kharkhovia { color: rgb(241, 194, 50); } /* Yellow for Kharkhovia */

        /* Hexagon container */
        .hex-container {
            position: relative;
            width: 315px; /* Increased size by 50% */
            height: 365px; /* Increased size by 50% */
            margin: 20px 0;
        }

        /* SVG hexagon styles */
        .hex-svg {
            width: 100%;
            height: 100%;
        }

        .hex-svg polygon {
            fill: transparent;
            stroke: #fff;
            stroke-width: 4;
        }

        .hex-svg .cascadea {
            stroke: rgb(53, 106, 29);
        }

        .hex-svg .kharkhovia {
            stroke: rgb(241, 194, 50);
        }

        /* Units displayed over the hexagon */
        .hex-units {
            position: absolute;
            top: 50%;
            left: 50%; /* Centered */
            transform: translate(-50%, -50%);
            color: #f0f0f0;
            font-size: 30px; /* Adjusted font size */
            text-align: center;
            width: 80%; /* Adjust as needed */
            white-space: normal;
            word-wrap: break-word;
            line-height: 1.2;
            /* Removed unit summary display */
        }

        /* Damage arrow display styles */
        .damage-arrow {
            position: absolute;
            top: 45%; /* Adjust as needed */
            right: -175px; /* Maintained from previous adjustment */
            transform: translateY(-50%);
            font-size: 30px; /* Adjust as needed */
            text-align: center;
        }

        /* Unit losses display styles */
        .unit-losses {
            position: absolute;
            top: 65%; /* Increased from 55% to 65% to widen the gap */
            right: -175px; /* Maintained from previous adjustment */
            transform: translateY(-50%);
            font-size: 24px; /* Adjust as needed */
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>WW1 Combat Simulator</h1>
    <div id="main-container">
        <!-- Unit Controls and Simulate Button -->
        <div id="combat-section">
            <!-- Unit Controls -->
            <div class="unit-controls">
                <h2><span class="cascadea">Cascadea's Units:</span></h2>
                <div class="unit-group">
                    <span class="unit-label">Infantry:</span>
                    <button onclick="changeUnits('cascadea', 'infantry', 1)">+1 üíÇ‚Äç‚ôÇÔ∏è</button>
                    <span id="cascadea-infantry">1</span>
                    <button onclick="changeUnits('cascadea', 'infantry', -1)">-1 üíÇ‚Äç‚ôÇÔ∏è</button>
                </div>
                <div class="unit-group">
                    <span class="unit-label">Cavalry:</span>
                    <button onclick="changeUnits('cascadea', 'cavalry', 1)">+1 üèá</button>
                    <span id="cascadea-cavalry">0</span>
                    <button onclick="changeUnits('cascadea', 'cavalry', -1)">-1 üèá</button>
                </div>
                <div class="unit-group">
                    <span class="unit-label">Armored Car:</span>
                    <button onclick="changeUnits('cascadea', 'armoredCar', 1)">+1 üöô</button>
                    <span id="cascadea-armoredCar">0</span>
                    <button onclick="changeUnits('cascadea', 'armoredCar', -1)">-1 üöô</button>
                </div>
            </div>
            <div class="unit-controls">
                <h2><span class="kharkhovia">Kharkhovia's Units:</span></h2>
                <div class="unit-group">
                    <span class="unit-label">Infantry:</span>
                    <button onclick="changeUnits('kharkhovia', 'infantry', 1)">+1 üíÇ‚Äç‚ôÇÔ∏è</button>
                    <span id="kharkhovia-infantry">1</span>
                    <button onclick="changeUnits('kharkhovia', 'infantry', -1)">-1 üíÇ‚Äç‚ôÇÔ∏è</button>
                </div>
                <div class="unit-group">
                    <span class="unit-label">Cavalry:</span>
                    <button onclick="changeUnits('kharkhovia', 'cavalry', 1)">+1 üèá</button>
                    <span id="kharkhovia-cavalry">0</span>
                    <button onclick="changeUnits('kharkhovia', 'cavalry', -1)">-1 üèá</button>
                </div>
                <div class="unit-group">
                    <span class="unit-label">Armored Car:</span>
                    <button onclick="changeUnits('kharkhovia', 'armoredCar', 1)">+1 üöô</button>
                    <span id="kharkhovia-armoredCar">0</span>
                    <button onclick="changeUnits('kharkhovia', 'armoredCar', -1)">-1 üöô</button>
                </div>
            </div>

            <button id="simulateButton" onclick="simulateCombat()">Simulate Combat</button>
        </div>

        <!-- Output Section -->
        <div id="output-section">
            <div id="output"></div>
        </div>

        <!-- Board Section -->
        <div id="board">
            <!-- Cascadea Section -->
            <div class="hex-container">
                <svg class="hex-svg" viewBox="0 0 100 100">
                    <polygon points="50,0 100,25 100,75 50,100 0,75 0,25" class="cascadea"></polygon>
                </svg>
                <div class="hex-units" id="cascadea-hex-units"></div>
                <!-- Damage Arrow Display -->
                <div class="damage-arrow" id="cascadea-damage-arrow"></div>
                <!-- Unit Losses Display -->
                <div class="unit-losses" id="cascadea-unit-losses"></div>
            </div>
            <!-- Kharkhovia Section -->
            <div class="hex-container">
                <svg class="hex-svg" viewBox="0 0 100 100">
                    <polygon points="50,0 100,25 100,75 50,100 0,75 0,25" class="kharkhovia"></polygon>
                </svg>
                <div class="hex-units" id="kharkhovia-hex-units"></div>
                <!-- Damage Arrow Display -->
                <div class="damage-arrow" id="kharkhovia-damage-arrow"></div>
                <!-- Unit Losses Display -->
                <div class="unit-losses" id="kharkhovia-unit-losses"></div>
            </div>
        </div>
    </div>

    <script>
        // Emojis
        const HIT_EMOJI = 'üí•';
        const BLOCK_EMOJI = 'üõ°Ô∏è';
        const MORALE_EMOJI = 'üö©'; // Updated Morale Emoji
        const MISS_EMOJI = '‚ö™';
        const infantryEmoji = 'üíÇ‚Äç‚ôÇÔ∏è';
        const cavalryEmoji = 'üèá';
        const armoredCarEmoji = 'üöô';

        // Number Emojis
        const numberEmojis = {
            '0': '0Ô∏è‚É£',
            '1': '1Ô∏è‚É£',
            '2': '2Ô∏è‚É£',
            '3': '3Ô∏è‚É£',
            '4': '4Ô∏è‚É£',
            '5': '5Ô∏è‚É£',
            '6': '6Ô∏è‚É£',
            '7': '7Ô∏è‚É£',
            '8': '8Ô∏è‚É£',
            '9': '9Ô∏è‚É£'
        };

        // Damage Arrow Emojis
        const cascadeaDamageArrowEmoji = '‚¨áÔ∏è';
        const kharkhoviaDamageArrowEmoji = '‚¨ÜÔ∏è';

        // Function to convert number to emojis
        function numberToEmojis(number) {
            return String(number).split('').map(digit => numberEmojis[digit] || digit).join('');
        }

        // Dice values with emojis and counts
        // Reverted Light Attack Dice: {Hit, Hit, Double Hit, Morale, Morale, Miss}
        const lightAttackDie = [
            { hits: 1, morales: 0, emoji: HIT_EMOJI },
            { hits: 1, morales: 0, emoji: HIT_EMOJI },
            { hits: 2, morales: 0, emoji: HIT_EMOJI + HIT_EMOJI },
            { hits: 0, morales: 1, emoji: MORALE_EMOJI },
            { hits: 0, morales: 1, emoji: MORALE_EMOJI },
            { hits: 0, morales: 0, emoji: MISS_EMOJI }
        ];

        // Updated Defence Dice: {Block, Block, Block, Double Block, Double Morale, Miss}
        const defenceDie = [
            { blocks: 1, morales: 0, emoji: BLOCK_EMOJI },
            { blocks: 1, morales: 0, emoji: BLOCK_EMOJI },
            { blocks: 1, morales: 0, emoji: BLOCK_EMOJI },
            { blocks: 2, morales: 0, emoji: BLOCK_EMOJI + BLOCK_EMOJI },
            { blocks: 0, morales: 2, emoji: MORALE_EMOJI + MORALE_EMOJI },
            { blocks: 0, morales: 0, emoji: MISS_EMOJI }
        ];

        // Reintroduced Heavy Attack Dice: {Hit, Hit, Double Hit, Triple Hit, Morale, Miss}
        const heavyAttackDie = [
            { hits: 1, morales: 0, emoji: HIT_EMOJI },
            { hits: 2, morales: 0, emoji: HIT_EMOJI + HIT_EMOJI },
            { hits: 2, morales: 0, emoji: HIT_EMOJI + HIT_EMOJI },
            { hits: 3, morales: 0, emoji: HIT_EMOJI + HIT_EMOJI + HIT_EMOJI },
            { hits: 0, morales: 1, emoji: MORALE_EMOJI },
            { hits: 0, morales: 0, emoji: MISS_EMOJI }
        ];

        // Unit Strengths
        const unitStrength = {
            infantry: 1,
            cavalry: 1,
            armoredCar: 2
        };

        // Unit counts
        const units = {
            cascadea: {
                infantry: 1,
                cavalry: 0,
                armoredCar: 0
            },
            kharkhovia: {
                infantry: 1,
                cavalry: 0,
                armoredCar: 0
            }
        };

        // Function to change units
        function changeUnits(faction, unitType, delta) {
            units[faction][unitType] = Math.max(units[faction][unitType] + delta, 0);
            document.getElementById(`${faction}-${unitType}`).innerText = units[faction][unitType];
            updateBoardUnits();
        }

        // Update units on the board
        function updateBoardUnits() {
            ['cascadea', 'kharkhovia'].forEach(faction => {
                let unitIcons = '';
                unitIcons += infantryEmoji.repeat(units[faction].infantry);
                unitIcons += cavalryEmoji.repeat(units[faction].cavalry);
                unitIcons += armoredCarEmoji.repeat(units[faction].armoredCar);
                document.getElementById(`${faction}-hex-units`).textContent = unitIcons;
            });
        }

        // Function to roll a die
        function rollDie(die) {
            return die[Math.floor(Math.random() * die.length)];
        }

        // Function to roll attack and defence for a faction
        function rollForFaction(faction, unitCounts) {
            let attackRolls = [];
            let defenceRolls = [];
            let totalHits = 0;
            let totalBlocks = 0;
            let totalMorales = 0;

            // Infantry rolls
            for (let i = 0; i < unitCounts.infantry; i++) {
                // Infantry rolls 1 Light Attack Die
                const attackRoll = rollDie(lightAttackDie);
                attackRolls.push(attackRoll);
                totalHits += attackRoll.hits;
                totalMorales += attackRoll.morales;

                // Infantry rolls 0 Defence Dice
            }

            // Cavalry rolls
            for (let i = 0; i < unitCounts.cavalry; i++) {
                // Cavalry rolls 2 Light Attack Dice
                for (let j = 0; j < 2; j++) {
                    const attackRoll = rollDie(lightAttackDie);
                    attackRolls.push(attackRoll);
                    totalHits += attackRoll.hits;
                    totalMorales += attackRoll.morales;
                }
                // Cavalry rolls 0 Defence Dice
            }

            // Armored Car rolls
            for (let i = 0; i < unitCounts.armoredCar; i++) {
                // Armored Car rolls 1 Light Attack Die
                let attackRoll = rollDie(lightAttackDie);
                attackRolls.push(attackRoll);
                totalHits += attackRoll.hits;
                totalMorales += attackRoll.morales;

                // Armored Car rolls 1 Heavy Attack Die
                attackRoll = rollDie(heavyAttackDie);
                attackRolls.push(attackRoll);
                totalHits += attackRoll.hits;
                totalMorales += attackRoll.morales;

                // Armored Car rolls 1 Defence Die
                const defenceRoll = rollDie(defenceDie);
                defenceRolls.push(defenceRoll);
                totalBlocks += defenceRoll.blocks || 0;
                totalMorales += defenceRoll.morales || 0;
            }

            return {
                attackRolls,
                defenceRolls,
                totalHits,
                totalBlocks,
                totalMorales
            };
        }

        // Function to simulate combat
        function simulateCombat() {
            let output = '';

            // Header
            output += `<h2><span class="cascadea">Cascadea (Attacker)</span> vs <span class="kharkhovia">Kharkhovia (Defender)</span></h2>`;

            // Display units with Total Strength
            const cascadeaTotalStrength = calculateTotalStrength('cascadea');
            const kharkhoviaTotalStrength = calculateTotalStrength('kharkhovia');

            const cascadeaUnitsDisplay = infantryEmoji.repeat(units.cascadea.infantry) + cavalryEmoji.repeat(units.cascadea.cavalry) + armoredCarEmoji.repeat(units.cascadea.armoredCar);
            const kharkhoviaUnitsDisplay = infantryEmoji.repeat(units.kharkhovia.infantry) + cavalryEmoji.repeat(units.kharkhovia.cavalry) + armoredCarEmoji.repeat(units.kharkhovia.armoredCar);

            output += `<p><span class="cascadea">Cascadea</span>: ${cascadeaUnitsDisplay} (${cascadeaTotalStrength} Strength)</p>`;
            output += `<p><span class="kharkhovia">Kharkhovia</span>: ${kharkhoviaUnitsDisplay} (${kharkhoviaTotalStrength} Strength)</p>`;

            // Roll for both factions
            const cascadeaRolls = rollForFaction('cascadea', units.cascadea);
            const kharkhoviaRolls = rollForFaction('kharkhovia', units.kharkhovia);

            // Output Cascadea's rolls
            output += `<h3><span class="cascadea">Cascadea's Rolls:</span></h3>`;
            output += `Attack Rolls: ${cascadeaRolls.attackRolls.map(roll => roll.emoji).join(', ')}<br>`;
            output += `Defence Rolls: ${cascadeaRolls.defenceRolls.map(roll => roll.emoji).join(', ')}<br>`;
            output += `Total Hits: ${cascadeaRolls.totalHits} ${HIT_EMOJI}<br>`;
            output += `Total Blocks: ${cascadeaRolls.totalBlocks} ${BLOCK_EMOJI}<br>`;
            output += `Total Morales: ${cascadeaRolls.totalMorales} ${MORALE_EMOJI}<br>`;

            // Output Kharkhovia's rolls
            output += `<h3><span class="kharkhovia">Kharkhovia's Rolls:</span></h3>`;
            output += `Attack Rolls: ${kharkhoviaRolls.attackRolls.map(roll => roll.emoji).join(', ')}<br>`;
            output += `Defence Rolls: ${kharkhoviaRolls.defenceRolls.map(roll => roll.emoji).join(', ')}<br>`;
            output += `Total Hits: ${kharkhoviaRolls.totalHits} ${HIT_EMOJI}<br>`;
            output += `Total Blocks: ${kharkhoviaRolls.totalBlocks} ${BLOCK_EMOJI}<br>`;
            output += `Total Morales: ${kharkhoviaRolls.totalMorales} ${MORALE_EMOJI}<br>`;

            // Calculate damage
            const cascadeaDamage = Math.max(kharkhoviaRolls.totalHits - cascadeaRolls.totalBlocks, 0);
            const kharkhoviaDamage = Math.max(cascadeaRolls.totalHits - kharkhoviaRolls.totalBlocks, 0);

            // Output Damage Dealt
            output += `<h3>Damage Dealt:</h3>`;
            output += `<span class="cascadea">Cascadea</span> deals ${kharkhoviaDamage} damage to <span class="kharkhovia">Kharkhovia</span>.<br>`;
            output += `<span class="kharkhovia">Kharkhovia</span> deals ${cascadeaDamage} damage to <span class="cascadea">Cascadea</span>.<br>`;

            // Update damage arrows
            updateDamageArrows(cascadeaDamage, kharkhoviaDamage);

            // Combat Resolution
            output += `<h3>Combat Resolution:</h3>`;
            const cascadeaResolution = resolveDamage('cascadea', cascadeaDamage);
            const kharkhoviaResolution = resolveDamage('kharkhovia', kharkhoviaDamage);
            output += cascadeaResolution.output;
            output += kharkhoviaResolution.output;

            // Update unit losses display
            updateUnitLosses('cascadea', cascadeaResolution.unitsLost);
            updateUnitLosses('kharkhovia', kharkhoviaResolution.unitsLost);

            // Determine Winner
            const cascadeaTotalUnits = totalUnits(units.cascadea);
            const kharkhoviaTotalUnits = totalUnits(units.kharkhovia);

            if (cascadeaTotalUnits > 0 && kharkhoviaTotalUnits === 0) {
                output += `<h2 class="cascadea">Cascadea Wins!</h2>`;
            } else if (kharkhoviaTotalUnits > 0 && cascadeaTotalUnits === 0) {
                output += `<h2 class="kharkhovia">Kharkhovia Wins!</h2>`;
            } else if (cascadeaTotalUnits === 0 && kharkhoviaTotalUnits === 0) {
                output += `<h2>It's a Tie!</h2>`;
            } else {
                output += `<p>Both armies survive the battle.</p>`;
            }

            // Update unit counts and board
            updateUnitDisplays();
            updateBoardUnits();

            // Update output
            document.getElementById('output').innerHTML = output;
        }

        // Function to update damage arrows
        function updateDamageArrows(cascadeaDamage, kharkhoviaDamage) {
            // Cascadea deals damage to Kharkhovia
            const cascadeaDamageEmojis = cascadeaDamageArrowEmoji + numberToEmojis(kharkhoviaDamage);
            document.getElementById('cascadea-damage-arrow').textContent = cascadeaDamageEmojis;

            // Kharkhovia deals damage to Cascadea
            const kharkhoviaDamageEmojis = kharkhoviaDamageArrowEmoji + numberToEmojis(cascadeaDamage);
            document.getElementById('kharkhovia-damage-arrow').textContent = kharkhoviaDamageEmojis;
        }

        // Function to update unit losses display
        function updateUnitLosses(faction, unitsLost) {
            let lossesDisplay = '';
            const minusEmoji = '‚ûñ';

            if (unitsLost.infantry > 0) {
                lossesDisplay += minusEmoji + infantryEmoji.repeat(unitsLost.infantry) + '<br>';
            }
            if (unitsLost.cavalry > 0) {
                lossesDisplay += minusEmoji + cavalryEmoji.repeat(unitsLost.cavalry) + '<br>';
            }
            if (unitsLost.armoredCar > 0) {
                lossesDisplay += minusEmoji + armoredCarEmoji.repeat(unitsLost.armoredCar);
            }

            document.getElementById(`${faction}-unit-losses`).innerHTML = lossesDisplay;
        }

        // Function to resolve damage for a faction
        function resolveDamage(faction, damage) {
            let output = '';
            let unitsLost = { infantry: 0, cavalry: 0, armoredCar: 0 };
            let unitTypes = ['infantry', 'cavalry', 'armoredCar'];

            // Sort unitTypes by strength ascending
            unitTypes.sort((a, b) => unitStrength[a] - unitStrength[b]);

            for (let unitType of unitTypes) {
                let unitStrengthVal = unitStrength[unitType];
                let unitCount = units[faction][unitType];
                while (unitCount > 0 && damage >= unitStrengthVal) {
                    damage -= unitStrengthVal;
                    unitsLost[unitType]++;
                    units[faction][unitType]--;
                    unitCount--;
                }
            }

            // Output damage resolution
            if (unitsLost.infantry > 0 || unitsLost.cavalry > 0 || unitsLost.armoredCar > 0) {
                if (totalUnits(units[faction]) === 0) {
                    output += `<p class="${faction}">${capitalizeFirstLetter(faction)}'s units are eliminated!</p>`;
                } else {
                    // Build a string that lists units lost
                    let losses = [];
                    if (unitsLost.infantry > 0) {
                        losses.push(`${unitsLost.infantry} Infantry`);
                    }
                    if (unitsLost.cavalry > 0) {
                        losses.push(`${unitsLost.cavalry} Cavalry`);
                    }
                    if (unitsLost.armoredCar > 0) {
                        losses.push(`${unitsLost.armoredCar} Armored Car`);
                    }
                    output += `<p>${capitalizeFirstLetter(faction)} loses ${losses.join(', ')}.</p>`;
                }
            } else {
                output += `<p>${capitalizeFirstLetter(faction)} did not lose any units.</p>`;
            }

            return { output: output, unitsLost: unitsLost };
        }

        // Function to calculate total units
        function totalUnits(factionUnits) {
            return factionUnits.infantry + factionUnits.cavalry + factionUnits.armoredCar;
        }

        // Function to calculate total strength
        function calculateTotalStrength(faction) {
            let total = 0;
            for (let unitType in units[faction]) {
                total += units[faction][unitType] * unitStrength[unitType];
            }
            return total;
        }

        // Function to update unit displays
        function updateUnitDisplays() {
            ['cascadea', 'kharkhovia'].forEach(faction => {
                document.getElementById(`${faction}-infantry`).innerText = units[faction].infantry;
                document.getElementById(`${faction}-cavalry`).innerText = units[faction].cavalry;
                document.getElementById(`${faction}-armoredCar`).innerText = units[faction].armoredCar;
            });
        }

        // Helper function to capitalize first letter
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        // Initialize board units
        updateBoardUnits();
    </script>
</body>
</html>
